<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚½ã‚·ãƒ£ã‚²é¢¨ã‚¬ãƒãƒ£</title>
    <style>
        body { background: #222; color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        .screen { display: none; width: 100vw; height: 100vh; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        /* --- ã‚¬ãƒãƒ£TOP --- */
        #lobby-screen { background: #1a2a6c; }
        .btn-group { display: flex; gap: 20px; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; border-radius: 50px; border: none; font-weight: bold; transition: 0.2s; }
        button:hover { transform: scale(1.1); }

        /* --- çµæœç”»é¢ --- */
        #result-screen { background: #111; }
        #result-container { display: grid; gap: 15px; margin-bottom: 30px; min-height: 300px; align-items: center; }
        /* ã‚«ãƒ¼ãƒ‰ã®åŸºæœ¬çŠ¶æ…‹ */
    .card {
        width: 100px;
        height: 140px;
        background: #444;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
    
        /* æœ€åˆã¯é€æ˜ã§ã€å°‘ã—ä¸‹ã«é…ç½®ã—ã¦ãŠã */
        opacity: 0;
        transform: translateY(30px) scale(0.8);
    }

        /* ã“ã®ã‚¯ãƒ©ã‚¹ãŒã¤ã„ãŸç¬é–“ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ */
    .show-card {
        animation: cardAppear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    @keyframes cardAppear {
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
        
        /* ãƒ¬ã‚¢ãƒªãƒ†ã‚£æ¼”å‡º */
        .r { background: #777; }
        .sr { background: #f5576c; border: 2px solid #fff; box-shadow: 0 0 10px #f5576c; }
        .ssr { background: gold; color: black; box-shadow: 0 0 20px gold; animation: flash 1s infinite; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

        /* è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .show-card { opacity: 1; transform: translateY(0); transition: 0.3s; }

        /* --- æ¼”å‡ºã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ --- */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; display: none; align-items: center; justify-content: center;
            z-index: 100; font-size: 40px; font-weight: bold;
        }
        /* ç‰¹æ®Šæ¼”å‡ºï¼šSRä»¥ä¸ŠãŒã„ã‚‹æ™‚ã®ã‚¯ãƒ©ã‚¹ */
        .rare-effect { color: gold; text-shadow: 0 0 20px gold; animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: translate(0,0); } 50% { transform: translate(3px,3px); } 100% { transform: translate(-3px,-3px); } }
    </style>
</head>
<body>

<div id="lobby-screen" class="screen active">
    <h1>å¬å–š</h1>
    <div class="btn-group">
        <button onclick="startGacha(1)">1å›å¬å–š</button>
        <button onclick="startGacha(10)" style="background: #ffaa00;">10å›å¬å–š</button>
    </div>
</div>

<div id="overlay">å¬å–šä¸­...</div>

<div id="result-screen" class="screen">
    <div id="result-container"></div>
    <div class="btn-group">
        <button onclick="toLobby()">æˆ»ã‚‹</button>
        <button id="retry-btn" onclick="startGacha(lastCount)" style="background: #ffaa00;">ã‚‚ã†ä¸€åº¦å¼•ã</button>
    </div>
</div>

<script>
    const lobbyScreen = document.getElementById('lobby-screen');
    const resultScreen = document.getElementById('result-screen');
    const resultContainer = document.getElementById('result-container');
    const overlay = document.getElementById('overlay');
    const retryBtn = document.getElementById('retry-btn');
    
    //ã‚­ãƒ£ãƒ©ãƒªã‚¹ãƒˆ
    const charList = {
        ssr: ["ğŸ‰", "ğŸ‘¸", "ğŸ’", "â˜„ï¸"],
        sr:  ["âš”ï¸", "ğŸ›¡ï¸", "ğŸ”¥", "ğŸ’§"],
        r:   ["ğŸŒ¿", "ğŸªµ", "ğŸ¦´", "âœ‰ï¸"]
    };

    // ... ã‚¬ãƒãƒ£ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸­ã§ ...
    const pool = charList[rarity];
    const character = pool[Math.floor(Math.random() * pool.length)];

    // ... ã‚«ãƒ¼ãƒ‰ç”Ÿæˆã®ä¸­ã§ ...
    card.innerHTML = `<div style="font-size:40px">${character}</div><div style="font-size:12px">${rarity.toUpperCase()}</div>`;

    let lastCount = 1; // ç›´å‰ã«å¼•ã„ãŸå›æ•°ã‚’ä¿å­˜

    async function startGacha(count) {
        lastCount = count;
        
        // 1. çµæœã®è¨ˆç®—
        const results = [];
        let hasRare = false; // SRä»¥ä¸ŠãŒã‚ã‚‹ã‹ãƒ•ãƒ©ã‚°
        const rates = { ssr: 0.03, sr: 0.17 };

        for (let i = 0; i < count; i++) {
            const rand = Math.random();
            let rarity = "r";
            if (rand < rates.ssr) { rarity = "ssr"; hasRare = true; }
            else if (rand < rates.ssr + rates.sr) { rarity = "sr"; hasRare = true; }
            results.push(rarity);
        }

        // 2. æ¼”å‡ºãƒ•ã‚§ãƒ¼ã‚º
        overlay.innerText = "å¬å–šä¸­...";
        overlay.classList.remove('rare-effect');
        overlay.style.display = "flex";

        await new Promise(r => setTimeout(r, 800)); // å°‘ã—å¾…æ©Ÿ

        // ã€Bï¼šç‰¹æ®Šæ¼”å‡ºã€‘SRä»¥ä¸ŠãŒã‚ã‚Œã°æ–‡å­—ãŒè±ªè¯ã«ï¼
        if (hasRare) {
            overlay.innerText = "é«˜ã‚¨ãƒãƒ«ã‚®ãƒ¼åå¿œï¼";
            overlay.classList.add('rare-effect');
            await new Promise(r => setTimeout(r, 1200)); 
        } else {
            await new Promise(r => setTimeout(r, 500));
        }

        // 3. ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        overlay.style.display = "none";
        lobbyScreen.classList.remove('active');
        resultScreen.classList.add('active');
        
        resultContainer.innerHTML = "";
        resultContainer.style.gridTemplateColumns = count === 1 ? "1fr" : "repeat(5, 1fr)";
        retryBtn.innerText = `ã‚‚ã†ä¸€åº¦(${count}å›)å¼•ã`;

        // 4. ã‚«ãƒ¼ãƒ‰ã‚’é †ç•ªã«è¡¨ç¤º
        for (const rarity of results) {
             const card = document.createElement('div');
             card.className = `card ${rarity}`;
             card.innerText = rarity.toUpperCase();
             resultContainer.appendChild(card);
    
        // ãƒ–ãƒ©ã‚¦ã‚¶ã«æç”»ã‚’ä¿ƒã™ãŸã‚ã€å°‘ã—ã ã‘å¾…ã£ã¦ã‹ã‚‰ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸
        await new Promise(r => setTimeout(r, 10)); 
        card.classList.add('show-card');
    
        // æ¬¡ã®ã‚«ãƒ¼ãƒ‰ãŒå‡ºã‚‹ã¾ã§ã®å¾…æ©Ÿæ™‚é–“
        await new Promise(r => setTimeout(r, 1500 / count));
    }
        }
    }

    function toLobby() {
        resultScreen.classList.remove('active');
        lobbyScreen.classList.add('active');
    }
</script>

</body>
</html>
